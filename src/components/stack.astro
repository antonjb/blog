---
import type { HTMLTag } from 'astro/types'
import type { Space } from '../types/space'

interface Props {
    space?: Space
    recursive?: boolean
    element?: HTMLTag
}

const { recursive = false, element: Element = 'div', space } = Astro.props
---

<!-- 
    Typically you would use Astro's define:vars to set the space variable 
    but that isn't supported with dynamic tags. Instead the value is passed inline
    If that ever changes, change this to use define:vars on the style tag.
    see: https://docs.astro.build/en/reference/astro-syntax/#dynamic-tags
-->
<Element
    class="stack"
    class:list={recursive ? 'recursive' : ''}
    style={`--space: var(--space-${space}, var(--space-0, 1.5rem));`}
>
    <slot />
</Element>

<style>
    .stack {
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        background-color: var(--background-color);
        color: var(--foreground-color);
    }

    .stack :global(> *) {
        margin-block: 0;
    }

    .stack :global(> * + *),
    .stack.recursive :global(* + *) {
        margin-block-start: var(--space, var(--space-0, 1.5rem));
    }

    /* Todo: make this dynamic for all space custom properties */
    .stack-exception,
    .stack-exception + * {
        --space: var(--space-3);
    }
</style>
